# GIS 基础

## GIS 概论及体系

### GIS 概论

> 前言：stay hungry, stay foolish

####  GIS

GIS 即地理信息系统（Geographic Information System），是一门集计算机科学、信息学、地理学等多门科学为一体的新型学科。百度地图、高德地图等 APP 让大众对于地图的认识和使用已经习以为常，但是 GIS 不只是地图。

对于 GIS 圈之外的人来讲，刚开始听到 GIS 觉得非常抽象，实际上 GIS 无处不在，生活中到处是 GIS。`地图是GIS的表现形式`，但 GIS 深层是空间信息的处理，所以大家从 GIS 地图上可以获取到地理空间信息的直观印象，更可以通过 GIS 获取大量的其他信息，如地物与周边地物的关系（主要是拓扑关系，相邻，包含，相离），更可以通过

### GIS 的应用价值

### 常见的 GIS 平台

### GIS 的标准及体系结构

## GIS 坐标系

GIS 的坐标系统大致有三种

- 平面坐标系（PlannerCoordinateSystem）：用于自定义坐标系统，局部小区域内的定义使用。
- 地理坐标系（GeographyCoordinateSystem）：为球面坐标。参考平面是椭球面，坐标单位：经纬度
- 投影坐标系（ProjectionCoordinateSystem）：为平面坐标，参考平面是水平面，坐标单位：米、千米等

### 大地坐标系

大地坐标系可分为参心大地坐标系和地心大地坐标系

`参心大地坐标系`

参心大地坐标系是指经过定位和定向后，地球椭球的中心不与地球质心重合而是接近地球质心。区域性大地坐标系是我国基本测图和常规大地测量的基础。如`北京54`、`Xian80`

`地心大地坐标系`

地心大地坐标系是指经过定位和定向后，地球椭球的中心与地球质心重合。如`CGCS2000`、`WGS84`

### 投影坐标系

> 坐标系统是 GIS 图形显示、数据组织分析的基础

`投影坐标系的实际问题`

我们做开发的时候，尤其是 web 地图开发，两种坐标系至关重要 `4326 GCS_WGS_1984`和`102100 WGS_1984_web_mercator_auxiliary_sphere`

- 4326 GCS_WGS_1984 是地理坐标系，它是 GPS 使用的坐标系，也就是通过 GPS 拿到的坐标信息都是按这个坐标系给我们的经度和纬度。当然，如果你是做移动平台上的 GPS，获取的经纬度也是按这个坐标系
- 102100 WGS_1984_mercator_auxiliary_sphere 则是目前在线地图采用的通用坐标系，属于投影坐标系

###

## GIS 数据

> 前面我们了解了坐标系，是 GIS 的骨架，但是要进一步明白 GIS，首先必须先理解地图的组成和数据结构。数据是 GIS 的一切开始，通常是 GIS 工程师来生产和处理相关数据

### 地图数据结构

GIS 地图数据由不同的图层构成，各图层内的数据可以分为`矢量`或`栅格`数据

`地图图层`

GIS 展示是通过不同的图层去描述，然后通过图层叠加展示来进行表达的过程。对于地图应用目标的不同，叠加的图层也是不同的，用以展示我们针对目标所需要的信息内容

#### WebGIS 的地图结构

二维 WebGIS 的数据结构为：

- 栅格底层图层
- 矢量图层

三维 WebGIS 的数据结构为：

- 地形图层
- 栅格底图图层
- 三维模型图层
- 矢量图层

在地图服务图层之上，我们可以按各地图平台提供的 api 开发业务图层叠加在上面，构成各种 GIS 业务应用系统

#### 矢量数据与栅格数据

GIS 采用矢量模型和栅格模型两种不同的数字模型来对现实世界进行模拟

`矢量数据`

矢量数据结构是如同 X，Y 或（XYZ）坐标，利用点线面的形式来表达现实世界，具有定位明显，属性隐含的特点，矢量数据具有数据结构紧凑，冗余度低，表达精度高的特点

`栅格数据`

栅格数据（瓦片模型）是以二维矩阵的形式来表示空间地物与现象分布的数据组织形式。每个矩阵单位作为一个栅格单元（cell）。栅格的每个数据表示地物或现象的属性数据。因此栅格数据由属性明显，定位隐含的特点。四叉树编码是最有效的栅格数据压缩编码方法之一，还能提高图形操作效率，具有可变的分辨率

#### 矢量数据与栅格数据的比较

栅格结构是矢量结构在某种程度上的一种近似，对于同一地物达到矢量数据相同的经度需要更大量的数据；在坐标位置搜索、计算多边形形状面积等方面栅格结构更为有效，而且易于与遥感相结合，易于信息共享

矢量结构对于拓扑关系的搜索则更为有效，网格信息只有用矢量才能完全描述，而且精度较高

对于地理信息系统软件来说，`两者共存，各自发挥优势是非常有效的`

| 数据类型 |                                  优点                                  | 缺点                                 |
| -------- | :--------------------------------------------------------------------: | ------------------------------------ |
| 矢量数据 | 数据结构紧凑、冗余率低，更有利于网格和检索分析，图形显示质量好，精度高 | 数据结构复杂，多边形叠加分析比较困难 |
| 栅格数据 |            数据结构简单，便于空间分析和地表模拟，显示性较强            | 数据量大，投影转换比较复杂           |

#### 常见的栅格数据

现在越来越多的地图服务用到瓦片技术，基本我们平常所接触的地图的地图都是瓦片地图。瓦片地图金字塔模型是一种多分辨率层次模型，从瓦片金字塔的底层到顶层，分辨率越来越低，但是表示的地理范围不变。

目前我们所见的所有地图地图服务都是瓦片地图的方式发布的。

`切片地图特征`

- 瓦片分辨率是 256x256
- 最小的地图等级是 0，此时世界地图只由一张瓦片组成
- 具有唯一的瓦片等级（z）和瓦片行列坐标编号（x,y）
- 瓦片等级越高，组成世界地图的瓦片数越多，可以展示的地图越详细
- 某一瓦片等级地图的瓦片是由低一级的各瓦片切割成的 4 个瓦片组成，形成了瓦片金字塔

### 常见的矢量数据

`要素`

矢量数据的单个对象我们称之为`要素`，即矢量图层内是由多个要素（Feature）构成的，而要素主要分为点、线、面等类型

`要素的数据结构`

要素数据由`坐标`、`样式`、`属性` 3 部分组成构成

| 构成 |     | 详情                                                               |
| ---- | --- | ------------------------------------------------------------------ |
| 坐标 |     | 地理位置，如经度、纬度、高度（三维 GIS 中）构成                    |
| 样式 |     | 表现形式，如图标图片、线条样式、填充色、文字样式等                 |
| 属性 |     | 除经纬度信息之外的关联信息，如名称、地址、电话、面积、长度、备注等 |

`要素的数据结构-坐标信息`

- 点：由经度、纬度、高度（三维 GIS 中）属性组成
- 线：由多个点组成
- 面：由一条或多条闭合线组成

### GIS 数据的生产

人们首先对地理事物进行管擦，认知其类型、特征、行为和关系，再对它进行分析、判别归类、简化、抽象和综合取舍。对现实世界进行抽象、描述和表达得到的概念模型，进而转换为逻辑模型和物理模型，这个过程有对应专业的学科：`测绘学`

#### 测绘学的历史及发展

测绘学主要是指研究地球的形状和大小，确定地面点的空间位置，将地球表面的形状和其他信息测绘成地图的科学

| 发展阶段          | 测量仪器                              | 测量理论                                     | 测量产品           |
| ----------------- | ------------------------------------- | -------------------------------------------- | ------------------ |
| 古代 17 世纪前    | 绳尺、步弓、矩尺、简单机械式          | 弧度测量、面积计算、理论原始简单             | 粗糙的地图         |
| 近代 17-20 世纪初 | 望远镜、经纬仪、水准仪、平板仪        | 三角测量、最小二乘法、地图投影，测图走向准确 | 实测的地图         |
| 现代 20 世纪初    | 电子仪器、航空摄影、GPS、电子智能仪器 | GIS、RS、GPS、数字测图，测量走向自动化       | 数字地球           |
| 未来              | 数字化、自动化、小型化、智能化        | 数字地球、智慧城市                           | 多维多样的数字服务 |

#### 人工手制或建模

利用专用建模软件，全靠人工去绘制矢量数据或模型。常用软件平台：3DMax，Maya进行人工建模，Revit进行BIM建模

#### 测绘仪器

测绘人员利用专业的测绘仪器仪表，在实地环境中测绘所得到的矢量数据。这样的采集方法耗时耗人都很厉害，二则周期长，三则是采集环境要求高。但是优点就是在于精度高，置信度，准确度非常高

#### 航拍

通过自己无人机拍摄或者购买的高精度航空照片或者卫星图片或者遥感照片，在此作为底片的基础上进行人为的矢量标注和勾勒，从而形成自己的矢量数据。或者通过专业GIS软件制作成DOM影像底图

### GIS数据来源

一般测绘局（军地各级测绘局、测绘中心等）和商业图商（高德、四维图新等）会进行地图的生产采集工作。我们使用的数据源也可以向其采购或使用互联网公开资源

| 数据类型    | 数据来源                          | 常见文件格式                                                 |
| ----------- | --------------------------------- | ------------------------------------------------------------ |
| DEM地形数据 | 互联网在线资源，航拍              | tif 、dem                                                    |
| DOM影像数据 | 互联网在线资源，航拍，采购        | tif、img                                                     |
| 矢量数据    | 互联网在线资源，采购              | shp、kml、geojson、dxf/dwg                                   |
| 三维模型    | 人工建模（含BIM），无人机倾斜摄影 | 倾斜摄影osgb，人工建模obj，dae，BIM数据dvt，dgn，点云las,ply |



### 常见的数据格式

`tif`

TIF文件作为栅格影像文件，后缀为tif或tiff，是ogc规范的一种，全称为GeoTiff。通常不能在资源管理器中查看tif栅格影像数据的坐标系信息，需要用GIS软件查看，因为它的坐标系信息写在数据文件内部

`dem`

dem有两种格式，NSDTF和USGS

- SGS-DEM 是美国地质调查局编写的一种公开格式的DEM数据格式标准
- NSDTF-DEM是中华人民共和国国家标准地球空间数据交换格式，是属于格网数据交换格式，一般的GIS软件都不支持这种格式

`shp`

shapefile文件是esri公司Arcgis平台的常用格式文件，是工业标准的矢量数据文件。shapefile将空间特征表中的非拓扑几何对象和属性信息存储在数据集中，特征表中的几何对象存为坐标点集表示的图形文件-shp文件，shapefile文件并不包含拓扑数据结构

- 一个shape文件包括三个文件：主文件（.shp），索引文件(.shx)，dBase表（.dbf）
- 一个shp文件只能存储点、线、面中的一种类型，不存在混合存在的状态
- shp可以设置很多的字段属性



`kml/kmz`

KML(Keyhole Makeuo Language)最初是由谷歌旗下的Keyhole'公司开发和维护的一种基于xml的标记性语言，利用xml语法格式描述地理空间数据（如点、线、面、多边形和模型等），适合网络条件下的地理信息协作和共享。2008年KML最新版本2.2被OGC宣布为开放地理信息编码标准，并改由OGC维护和发展

KMZ是压缩过的KML文件，由于KML是压缩包，因此它不仅能包含KML文本，也能包含与之关联的如图片、模型等其他文件

`dwg/dxf`

dwg文件是由Autodesk公司AutoCAD平台的图形文件格式，是二维或三维的图形档案。其与dxf文件是可以互相转化的

dxf文件是AutoCAD推出的与其他软件平台之间进行数据交换的开放的矢量数据格式

由于AutoCAD是最流行的CAD系统，DXF也被广泛应用，成为事实上的标准。绝大多数CAD系统都能读入或输出DXF文件

`geojson`

GeoJSON是适合于Web下对各种地理数据结构进行编码的格式，基于Javascriot对象表示法的地理空间信息数据交换格式。与普通json文件格式区别在于对其属性及组成有一定规范

GeoJSON将所有的地理要素分为Point、MultiPoint、LineString、MultiLineString、Polygon、MultiPolygon、GeometryCollection  首先是将这些要素封装到单个的geometry里，然后作为一个个的feature（要素），要素放到一个要素集合里构成。

```json
{
  type: "FeatureCollection",
  features: [{
    type: "Feature",
    geometry: {
      type: "Point",
      coordinates: [102.0, 0.5]
    }
  }]
}
```



`wkt`

wkt是一个标记语言，全称Well Known Text 出自OGC

wkt是用文本形式记录地理信息的一个标记语言。什么是地理信息？除开我们常见的真.地理信息点线面之类，还包括坐标系统的定义。我们可以在epsg.io这个网站查询想知道的坐标系的wkid，也可以查到想知道坐标系的wkt，此处不展开wkt每一项定义，可以网上查阅相关资料

wkt还有一种二进制存储格式，叫wkb。有关这两个东西的文档可以在ogc管网上可寻



`osgb`

目前市面上生产的倾斜模型，尤其是Smart3D处理的倾斜摄影三维模型数据的组织形式一般是二进制存储的、带有嵌入式链接纹理数据（.jpg）的osgb格式。Open Scene Graphic Binary 是osgb的全称，这里的binary是二进制的意思



`obj` 

obj文件是Alias | Wavefront公司为它的一套基于工作站的3D建模和动画软件`AdvancedVisualizer` 开发的一种标准3D模型文件格式，很适合用于3D软件模型之间的互导。obj是三维模型的一种万能格式，大部分三维软件都支持

> 一个obj文件一般包含obj，mtl，纹理图片 三个文件

### GIS数据存储

业务数据：Mysql等普通数据库

栅格数据：MongoDB

矢量数据：PostGIS

少量数据时

- 栅格数据、无需编辑的矢量文件数据可以直接存放到计算机硬盘文件夹中

- 在业务数据库相关表中，加入`经度x`、`纬度y`、`高度z` 字段后，直接将矢量数据存放下业务数据中中

### 常用的数据类型

`影像`

影像地图是指一种带有路面遥感影像的地图，是利用航空像片或卫星遥感影像，通过几何纠正、投影变换和比例尺规化，运用一定的地图符号、注记，直接反应制图对象地理特征及空间分布的地图

`Raster`

栅格影像，也称`光栅图像`、`栅格图形`，是指在空间和亮度上都已经离散化了的图像。我们可以把一幅栅格图像考虑为一个矩阵，矩阵中的任一元素对应于图像中的一个点，而对应的值对应于该点的灰度级，数字矩阵中的元素叫做`像素`

`矢量`

矢量图是根据几何特性来绘制图形，矢量可以是一个点或一条线，矢量图只能靠软件生成，文件占用内在空间较小，因为这种类型的图像文件包含独立的分离图像，可以自由无限制的重新组合。它的特点是放大后图像不会失真和分辨率无关，适用于图形设计、文字设计和一些标志设计、板式设计等。

`DEM`

数字高程模型，是通过有限的地形高程数据实现对地面地形的数字化模拟（即地形表面形态的数字化表达），它是用一组有序数值阵列形式表示地面高程的一种实体地面模型，是`数字地形模型`(**Digital Terrain Model**，简称 DTM)的一个分支，其它各种地形特征值均可由此派生

`DOM`

DOM 数字正射影像图（Digital Orthophoto Map）是针对航空（或航天）相片进行数字微分纠正和镶嵌，按一定图幅范围裁剪生成的数字正射影像集。它是同时具有地图几何精度和影像特征的图像。

`Shp`

shape 文件是由 Esri 开发，一个 Esri 的 shape 文件包括一个主文件，一个索引文件，一个`dBase`表。其中主文件的后缀就是`.shp`

## GIS 服务

> 定义：在网络环境下的一组与地理信息相关的软件功能实体，通过接口暴露封装的 GIS 功能

### 常用的 GIS 服务类型

`WMS`:

Web 地图服务（Web Map Service）利用具有空间位置信息的数据制作地图。其中将地图定义为地理数据可视的表现。这个规范定义了三个操作：`GetCapabotities`返回服务级元数据，它是对服务信息内容和要求参数的一种描述；`GetMap` 返回一个地图影像，其地理空间参考和大小参数是明确定义了的；`GetFeatureInfo`(可选)，返回显示在地图上的某些特殊要素的信息

`WFS`

Web 要素服务（Web Feature Service）基础接口是`GetCapabilities`。支持对地理要素的插入、更新、删除、检索和发现服务。

`WCS`

WCS(Web Coverage Sevice)是 OGC 定义的在 Web 上以`Coverage`形式共享地理空间数据的规范。所谓`Coverage`是指能够返回其时空域中任何指定点的值得数据，其形式易于输入到模型中使用。WCS 服务是以`Coverage`的形式实现了栅格影像数据集的共享。提供的是包含了地理位置信息或属性的空间栅格图层，而不是静态地图的访问。根据 HTTP 客户端要求发送相应数据，包括影像，多光谱影像和其他科学依据。WCS 对应基于栅格数据的功能，与 WMS 基于矢量数据的特点相对应。

`WMTS`

WMTS(Web Map Tile Server)是 Web 地图瓦片服务。WMTS 标准定义了一些操作，这些操作允许用户访问瓦片地图。WMTS 可能是 OGC 首个支持`restful`访问的服务标准。WMTS 提供了一种采用预定义图块方法发布数字地图服务的标准化解决方案。WMTS 弥补了 WMS 不能提供分块地图的不足。WMS 针对提供可定制地图的服务，是一种动态数据或用户定制地图（需结合 SLD 标准）的理想解决方法。

`矢量切片`

矢量切片可以以三种形式呈现：`GeoJson`、`TopoJson`和`MapBox Vector Tile`(`.mvt`)，矢量切片技术继承了矢量数据和切片服务的双重优势，有如下优点：

- 对于栅格切片，更灵活，更细粒度的数据划分要素级别
- 数据信息接近无损，但体积更小，请求指定地物信息，直接在客户端获取，无需再次请求服务器
- 样式可改变和定制（`重点`），矢量切片可以在服务端或者服务器端渲染，可以按照用户赋予的样式渲染
- 对于原始矢量数据，更小巧，采取了重新编码，并进行了切分，只返回请求区域和相应级别的数据
- 数据更新快，可以说是实时的，当数据库中的空间数据变化后，再次请求的数据是改变的后的，在客户端渲染后既是最新的情况
- 更灵活，可以只是返回每个专题数据的图层，而不是像栅格切片把很多专题数据渲染在一个底图中

`互联网在线服务`

- 国际

  - 谷歌google地图

    谷歌地图作为世界上最好的地图服务提供商，唯一的全能，毋容置疑的GIS服务领跑者

  - mapbox多样式地图

  - 微软bing地图

  - arcgis online地图

- 国内

  - 天地图（国家测绘局）

    天地图是`国家测绘地理信息局`建设的`国家地理信息公共服务平台`。作为中国区域内官方的地理信息服务网站。目前为国内唯一标准坐标系，是数据权威可信的公共服务平台，主要的服务标准都是OGC标准发布

  - 高德地图（阿里巴巴）

    GCJ-02火星偏移坐标系

  - 百度地图（百度）

    BD-09百度坐标系，在火星坐标基础上进行二次加密

  - 腾讯地图（腾讯）

### 项目中GIS服务的发布

`Nginx`

Nginx，主要用于离线底图服务、terrain地形、3dtitles三维模型等静态资源服务

`GeoServer`

矢量数据

`互联网在线地图服务`

一般都是直接使用其底图服务、web查询服务（在线环境下）

## GIS 应用开发

> 客户端应用是研发人员主要参与的GIS的核心部分

### 开发框架的分类

| 平台              | 框架                                    |
| ----------------- | --------------------------------------- |
| 专业商业GIS平台   | Arcgis、Supermap、Skyline等             |
| 在线图商的公众sdk | 百度、高德、谷歌、天地图、Mapbox等      |
| 开源GIS平台       | Openlayers、Leaflet、MapboxGL、Cesium等 |

### 开发框架的选型

`为什么选取开源软件`

- 商业软件昂贵、中小型企业消费不起
- 闭源，当你好奇一个个地图是如何显示出来的，这一个个投影是如何体现在地图上的，这一系列数据是如何存储到shapefile、存储到数据库的，这一个个分析功能是如何解决的，等等。显然这些商业软件不会告诉你答案，他们提供的开发接口都是一个个的黑箱

于是我们将触角转向开源软件界，试图去寻觅这些问题的答案。最终根据比较选型后，选取了两款开源的开发框架：`openLayers`和`Cesium`

## GIS 的发展与未来

### GIS近期的发展

GIS是空间技术和信息技术的交叉学科，相关领域的研究热点都有可能成为GIS的发展趋势。GIS的技术环节无外乎数据获取、数据分析、数据呈现三个方面，从近年的发展情况来看，GIS在这三方面都有着激动人心的发展成果

`数据获取`

- 倾斜摄影测量
- 近景摄影测量
- 影像智能识别
- 智能数据匹配
- 定位技术发展（室内、高精度、小型化）

`数据分析`

- 高效的数据管理
- 跨行业数据透视
- 空间尺度衍深（宏观、围观）
- 迅捷的处理速度
- 从计算到决策

`数据呈现`

- 无限扩张的三维空间
- VR和AR
- 精彩纷呈的Web地图
- 潜力无限的手机App
- 叹为观止的专业化应用

`倾斜摄影测量`

倾斜摄影测量是这两年蓬勃发展的一项技术，相对于竖直航空摄影在地物里面信息获取方面的缺陷，倾斜航空摄影可以快速获取大范围区域地表物体三维立面信息，可以支持对摄影区域的三维测量。倾斜摄影测量有着非常高的高程测量精度，可以实现快速的大场景建模与地物测量，能够生成接近真实的地表三维场景

`定位技术发展`

智能手机让每个人都有了感知地理位置的能力，然而目前的定位还存在着许多局限。例如室内、野外还有很多卫星定位忙去，定位精度好不够高，高精度定位设备不够便携等。现在，室内定位、差分定位、网络定位等技术发展很快。不远的未来，仅用一部手机甚至是手表就可以实现随时随地精准定位至厘米水平。定位信息的迅速发展，会为位置服务的应用带来深远的影响

`空间信息扩展（地下、深海、深空）`

目前空间信息在很多人的概念中依然是地面或者近地面的信息，随着探索和测量手段的不断发展，人类活动范围已经扩展到了地下空间、深海、外太空甚至地外行星，观测尺度从空间更是扩展到了时空。更广袤的时空信息不断涌现，催生着GIS上天入地，谈古论今，这样未来只能说眼界限制了我们的想象

`跨行业数据透视`

GIS实际上也是math insight，空间数据分析和挖掘一直是GIS最强大的武器，随着大数据、云计算的发展，数据进入了一个爆炸的世道，GIS数据能够与很多行业数据进行交叉，产生奇妙的化学反应。随着研究人员的不断努力，现在很多行业的评价、统计、分析指标都加入了位置参数，GIS开始走出家门，说百家话，穿万家衣

### 



